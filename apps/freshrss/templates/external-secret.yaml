---
apiVersion: external-secrets.io/v1
kind: ExternalSecret
metadata:
  name: freshrss-vault-sso
spec:
  secretStoreRef:
    kind: ClusterSecretStore
    name: vault
  target:
    name: freshrss-vault-sso
  data:
    - secretKey: OIDC_CLIENT_CRYPTO_KEY
      remoteRef:
        key: /freshrss/sso
        property: crypto_passphrase
---
apiVersion: external-secrets.io/v1
kind: ExternalSecret
metadata:
  name: freshrss-sso
spec:
  secretStoreRef:
    kind: SecretStore
    name: k8s-store
  target:
    name: freshrss-sso
    template:
      data:
        OIDC_CLIENT_CRYPTO_KEY: {{ `{{ .OIDC_CLIENT_CRYPTO_KEY | toString }}` | quote }}
        OIDC_CLIENT_ID: {{ `{{ .CLIENT_ID | toString }}` | quote }}
        OIDC_CLIENT_SECRET: {{ `{{ .CLIENT_SECRET | toString }}` | quote }}
  dataFrom:
    - extract:
        key: freshrss-vault-sso
    - extract:
        key: freshrss-kanidm-oauth2-credentials
