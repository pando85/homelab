app-template:
  controller:
    # HA is not supported
    type: statefulset

  image:
    repository: pando85/389ds
    tag: 2.2.5
  env:
    DS_ERRORLOG_LEVEL: "266354688"
    DS_SUFFIX_NAME: dc=grigri,dc=cloud
  envFrom:
    - secretRef:
        name: ldap-secret
  service:
    main:
      type: LoadBalancer
      annotations:
        metallb.universe.tf/loadBalancerIPs: "192.168.193.3"
      externalTrafficPolicy: Local
      ports:
        http:
          enabled: false
        ldap:
          primary: true
          port: 389
          protocol: TCP
          targetPort: 3389
        ldaps:
          port: 636
          protocol: TCP
          targetPort: 3636

  initContainers:
    chown:
      image: busybox:1.36.1
      command: ["sh", "-c", "chown -R 389:389 /data"]
      volumeMounts:
        - name: data
          mountPath: /data

  ingress:
    main:
      enabled: false

  podSecurityContext:
    fsGroup: 389

  persistence:
    data:
      enabled: true
      mountPath: /data
      existingClaim: ldap-data-zfs
    certs:
      enabled: true
      type: secret
      name: ldap-certs
      mountPath: /data/tls
      readOnly: true
    ca:
      enabled: true
      type: secret
      name: ldap-ca
      mountPath: /data/tls/ca
      readOnly: true
  resources:
    requests:
      cpu: 50m
      memory: 1Gi
    limits:
      memory: 1Gi
